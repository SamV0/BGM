{% extends 'base.html' %}
{% block title %}Update Inventory{% endblock %}
{% block header %}
<a href="{{ url_for('main.inventory.inventory_read.inventory_read') }}">&xlArr;</a>
<h2>Update Inventory</h2>
{% endblock %}
{% block content %}
<form method="POST">
    <label for="item_id">Item</label>
    <select id="item_id" name="item_id" >
        <option value="">Select Item</option>
        {% for item in items %}
        <option value="{{ item.id }}" {% if item.id == inventory.item_id %}selected{% endif %}>
            {{ item.full_name }}
        </option>
        {% endfor %}
    </select>

    <label for="godown">Godown</label>
    <select id="godown" name="godown_id" onchange="updateRacks(this.value)" >
        <option value="">Select Godown</option>
        {% for godown in godowns %}
        <option value="{{ godown.id }}" {% if godown.id == inventory.godown_id %}selected{% endif %}>
            {{ godown.name }}
        </option>
        {% endfor %}
    </select>

    <label for="rack_id">Rack</label>
    <select id="rack_id" name="rack_id" >
        <option value="">Select Rack</option>
    {% for rack in racks %}
    <option value="{{ rack.id }}" 
        {% if rack.id == inventory.godown_id.rack_id %}selected{% endif %}>
        {{ rack.name }}
    </option>
    {% endfor %}
    </select>

    <label for="avl_qnty">Available Quantity</label>
    <input type="number" id="avl_qnty" name="avl_qnty"  min="0" value="{{ inventory.avl_qnty }}">

    <label for="min_qnty">Minimum Quantity</label>
    <input type="number" id="min_qnty" name="min_qnty"  min="0" value="{{ inventory.min_qnty }}">

    <label for="rod_qnty">Rod Quantity</label>
    <input type="number" id="rod_qnty" name="rod_qnty"  min="0" value="{{ inventory.rod_qnty }}">

    <button type="submit">Update Inventory</button>
</form>

<script>
function updateRacks(godownId) {
    const rackSelect = document.getElementById('rack_id');
    const rackOptions = rackSelect.getElementsByTagName('option');
    
    rackSelect.value = '';
    
    for (let option of rackOptions) {
        if (option.value === '') {
            option.hidden = false;
            continue;
        }
        
        if (option.getAttribute('data-godown') === godownId) {
            option.hidden = false;
        } else {
            option.hidden = true;
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const godownSelect = document.getElementById('godown');
    if (godownSelect.value) {
        updateRacks(godownSelect.value);
    }
});
</script>
{% endblock %}