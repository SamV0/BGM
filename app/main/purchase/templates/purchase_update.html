{% extends "base.html" %}
{% block title %}Update Purchase{% endblock %}

{% block content %}
<div class="container">
    <h2>Update Purchase Order</h2>
    <form method="POST">
        <p><strong>Order Date:</strong> {{ purchase.ordered_date.strftime('%Y-%m-%d') }}</p>
        
        <label for="supplier_id">Supplier</label>
        <select name="supplier_id"  {% if purchase.status != 'draft' %}disabled{% endif %}>
            <option value="">Select Supplier</option>
            {% for supplier in suppliers %}
            <option value="{{ supplier.id }}" {% if supplier.id == purchase.supplier_id %}selected{% endif %}>
                {{ supplier.name }}
            </option>
            {% endfor %}
        </select>
        <br>
        <label for="item_id">Item</label>
        <select name="item_id"  {% if purchase.status != 'draft' %}disabled{% endif %}>
            <option value="">Select Item</option>
            {% for item in items %}
            <option value="{{ item.id }}" {% if item.id == purchase.item_id %}selected{% endif %}>
                {{ item.name }}
            </option>
            {% endfor %}
        </select>
        <br>
        <label for="ordered_weight">Weight (kg)</label>
        <input type="number" name="ordered_weight" step="0.01" min="0.01"
               value="{{ purchase.ordered_weight }}"  
               {% if purchase.status != 'draft' %}readonly{% endif %}>
        <br>
        <label for="expected_date">Expected Date</label>
        <input type="date" name="expected_date" 
               value="{{ purchase.expected_date.strftime('%Y-%m-%d') }}" 
               {% if purchase.status != 'draft' %}readonly{% endif %}>
        <br>
        <label for="remarks">Remarks</label>
        <textarea name="remarks" rows="3">{{ purchase.remarks or '' }}</textarea>
        <br>
        <p><strong>Status:</strong> 
            <span class="badge {% if purchase.status == 'draft' %}bg-secondary
                             {% elif purchase.status == 'ordered' %}bg-primary
                             {% elif purchase.status == 'received' %}bg-success
                             {% elif purchase.status == 'cancelled' %}bg-danger
                             {% endif %}">
                {{ purchase.status }}
            </span>
        </p>

        {% if purchase.status == 'draft' %}
        <select name="status">
            <option value="draft" {% if purchase.status == 'draft' %}selected{% endif %}>Draft</option>
            <option value="ordered">Order</option>
            <option value="cancelled">Cancel</option>
        </select>
        {% endif %}

        {% if purchase.status == 'ordered' %}
        <div>
            <label>Receive Order</label>
            <input type="date" name="received_date">
            <button type="submit" name="status" value="received">Mark as Received</button>
        </div>
        {% endif %}

        <button type="submit" {% if purchase.status != 'draft' and not purchase.status == 'ordered' %}disabled{% endif %}>
            Update Purchase Order
        </button>
        <a href="{{ url_for('main.purchase.purchase_read.purchase_read') }}">&xlArr;</a>
    </form>
</div>
{% endblock %}